generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Account {
  id                String    @id @default(uuid()) @db.Uuid
  userId            String    @map("user_id") @db.Uuid
  type              String    @db.VarChar(255)
  provider          String    @db.VarChar(255)
  providerAccountId String    @map("provider_account_id") @db.VarChar(255)
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?   @db.VarChar(255)
  scope             String?   @db.VarChar(255)
  id_token          String?
  session_state     String?   @db.VarChar(255)
  createdAt         DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt         DateTime? @default(now()) @map("updated_at") @db.Timestamp(6)
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([provider, providerAccountId])
  @@index([provider, providerAccountId], map: "idx_accounts_provider")
  @@index([userId], map: "idx_accounts_user_id")
  @@map("accounts")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model emotion_analyses {
  id                    String                  @id @default(uuid()) @db.Uuid
  user_id               String                  @db.Uuid
  emotion               String                  @db.VarChar(50)
  confidence            Decimal                 @db.Decimal(5, 4)
  image_url             String?
  metadata              Json?
  created_at            DateTime?               @default(now()) @db.Timestamp(6)
  users                 User                    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  music_recommendations music_recommendations[]

  @@index([created_at], map: "idx_emotion_analyses_created_at")
  @@index([emotion], map: "idx_emotion_analyses_emotion")
  @@index([user_id, emotion], map: "idx_emotion_analyses_user_emotion")
  @@index([user_id], map: "idx_emotion_analyses_user_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model music_recommendations {
  id                  String            @id @default(uuid()) @db.Uuid
  user_id             String            @db.Uuid
  emotion_analysis_id String?           @db.Uuid
  emotion             String            @db.VarChar(50)
  track_id            String            @db.VarChar(255)
  track_name          String            @db.VarChar(500)
  artist_name         String            @db.VarChar(500)
  album_name          String?           @db.VarChar(500)
  track_url           String?
  image_url           String?
  duration_ms         Int?
  popularity          Int?
  audio_features      Json?
  was_played          Boolean?          @default(false)
  user_rating         Int?
  created_at          DateTime?         @default(now()) @db.Timestamp(6)
  emotion_analyses    emotion_analyses? @relation(fields: [emotion_analysis_id], references: [id], onUpdate: NoAction)
  users               User              @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at], map: "idx_music_recommendations_created_at")
  @@index([emotion], map: "idx_music_recommendations_emotion")
  @@index([track_id], map: "idx_music_recommendations_track_id")
  @@index([user_id], map: "idx_music_recommendations_user_id")
}

model Session {
  id           String    @id @default(uuid()) @db.Uuid
  sessionToken String    @unique @map("session_token") @db.VarChar(255)
  userId       String    @map("user_id") @db.Uuid
  expires      DateTime  @db.Timestamp(6)
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([sessionToken], map: "idx_sessions_session_token")
  @@index([userId], map: "idx_sessions_user_id")
  @@map("sessions")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model user_activity {
  id            String    @id @default(uuid()) @db.Uuid
  user_id       String    @db.Uuid
  activity_type String    @db.VarChar(100)
  activity_data Json
  session_id    String?   @db.VarChar(255)
  ip_address    String?   @db.Inet
  user_agent    String?
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  users         User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at], map: "idx_user_activity_created_at")
  @@index([activity_type], map: "idx_user_activity_type")
  @@index([user_id], map: "idx_user_activity_user_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model user_preferences {
  id                       String    @id @default(uuid()) @db.Uuid
  user_id                  String    @unique @db.Uuid
  preferred_genres         String[]
  disliked_genres          String[]
  preferred_artists        String[]
  music_discovery_level    Int?      @default(3)
  explicit_content_allowed Boolean?  @default(false)
  language_preferences     String[]  @default(["es", "en"])
  notification_preferences Json?     @default("{}")
  privacy_settings         Json?     @default("{}")
  created_at               DateTime? @default(now()) @db.Timestamp(6)
  updated_at               DateTime? @default(now()) @db.Timestamp(6)
  users                    User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_user_preferences_user_id")
}

model user_statistics {
  id                    String    @id @default(uuid()) @db.Uuid
  user_id               String    @unique @db.Uuid
  total_analyses        Int?      @default(0)
  total_recommendations Int?      @default(0)
  most_common_emotion   String?   @db.VarChar(50)
  favorite_genre        String?   @db.VarChar(100)
  average_mood_score    Decimal?  @db.Decimal(3, 2)
  last_activity         DateTime? @db.Timestamp(6)
  statistics_data       Json?
  calculated_at         DateTime? @default(now()) @db.Timestamp(6)
  users                 User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_user_statistics_user_id")
}

model User {
  id                    String                  @id @default(uuid()) @db.Uuid
  name                  String?                 @db.VarChar(255)
  email                 String                  @unique @db.VarChar(255)
  password              String?
  emailVerified         DateTime?               @map("email_verified") @db.Timestamp(6)
  image                 String?
  createdAt             DateTime?               @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt             DateTime?               @default(now()) @map("updated_at") @db.Timestamp(6)
  accounts              Account[]
  emotion_analyses      emotion_analyses[]
  music_recommendations music_recommendations[]
  sessions              Session[]
  user_activity         user_activity[]
  user_preferences      user_preferences?
  user_statistics       user_statistics?

  @@index([email], map: "idx_users_email")
  @@map("users")
}

model VerificationToken {
  token      String   @id @db.VarChar(255)
  identifier String   @db.VarChar(255)
  expires    DateTime @db.Timestamp(6)

  @@unique([identifier, token])
  @@map("verification_tokens")
}
